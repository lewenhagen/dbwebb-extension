(()=>{var r={permanentListeners:[],permanent:"permanent",content:"content",contentListeners:[],addEventListener:function(t,n,e,i){t.addEventListener(n,e),console.log(r.contentListeners),console.log(r.permanentListeners),i===r.permanent?r.permanentListeners.push([t,n,e]):r.contentListeners.push([t,n,e])},clearAllListeners:function(){console.log(r.permanentListeners),r.permanentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),r.permanentListeners=[],r.clearContentListeners()},clearContentListeners:function(){console.log(r.contentListeners),r.contentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),r.contentListeners=[],console.log(r.contentListeners)}},o=r;var v={name:"Close menu",actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&v.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),o.clearAllListeners()}},l=v;var x={name:"Settings",addEventListeners:function(t){let n=document.getElementById("addToStudentUrlPath");n.focus(),o.addEventListener(n,"input",function(a){window.sessionStorage.setItem("addToStudentUrlPath",a.target.value)},o.content);let e=document.getElementById("exitOnAction");o.addEventListener(e,"change",function(){window.sessionStorage.setItem("exitOnAction",e.checked)},o.content);let i=document.getElementById("return");o.addEventListener(i,"click",function(a){o.clearContentListeners(),t()},o.content);let c=document.getElementById("reset");o.addEventListener(c,"click",function(a){window.sessionStorage.clear(),o.clearContentListeners(),renderHtml(t)},o.content)},renderHtml:function(t){console.log("hej");let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=window.sessionStorage.getItem("exitOnAction")=="true",i=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${n||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${e?"checked":"undefined"}>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,c=document.getElementById("menuContent");c.innerHTML=i,x.addEventListeners(t)}},d=x;var y=300,w=400,s=document.createElement("div");s.id="menu";s.style.height=`${y}px`;s.style.width=`${w}px`;s.style.position="absolute";s.style.top=window.innerHeight/2-y/2+"px";s.style.left=window.innerWidth/2-w/2+"px";s.style.border="5px solid black";s.style.padding="1em";s.style.backgroundColor="rgba(113, 77, 168, 0.86)";s.style.color="white";s.style.fontSize="24px";var E=document.createElement("div");E.id="menuContent";var m=document.createElement("div");m.style.position="absolute";m.style.right=0;m.style.bottom=0;var g=document.createElement("button");g.id=l.name;g.innerText=l.name;var h=document.createElement("button");h.id=d.name;h.innerText=d.name;m.appendChild(h);m.appendChild(g);s.appendChild(E);s.appendChild(m);var L=s;var T={name:"Open student link",action:function(){let t=window.sessionStorage.getItem("addToStudentUrlPath"),n=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,c=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(n);if(c!==null){let a=`${c}me/${t||""}`;window.open(a,"_blank")}l.actionRemove()}},b=T;var _={name:"Open Umbridge link",action:function(){let t=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,n=document.querySelectorAll("div.comment_flex > span");n.length==0&&(n=document.querySelectorAll("[data-testid=submission-comment]"));for(var e=n.length-1;e>=0;e--){let i=n[e].innerHTML.match(t),c=!1;if(i!==null){window.open(i,"_blank");break}}l.actionRemove()}},k=_;var $={name:"Calculate quiz score",action:function(){let t=document.querySelectorAll(".assignment_score"),n=0,e=0;t.forEach(i=>{i.parentElement.querySelectorAll(".tooltip").forEach(a=>{let u=a.innerText.replace(/\s/g,""),C=/(-|\d[\d,]*)\/(\d[\d,]*)/,p=u.match(C);if(p){p[1]==="-"&&(p[1]=0);let B=parseFloat(p[1]),A=parseFloat(p[2]);n+=B,e+=A}})}),alert(`Po\xE4ng: ${n} / ${e}
Score: ${Math.ceil(n/(e/2)*10)/10/2}`),l.actionRemove()}},I=$;var f=[b,k,I];function R(){document.body.appendChild(L);let t=document.getElementById(l.name);o.addEventListener(t,"click",l.manualRemove,o.permanent);let n=document.getElementById(d.name);o.addEventListener(n,"click",function(){o.clearContentListeners(),d.renderHtml(S)},o.permanent)}function P(){let t=document.getElementsByClassName("menuItem");for(let n of t)o.addEventListener(n,"click",function(e){f[e.target.id].action()},o.content),n.onmouseover=function(e){e.target.style.cursor="pointer",e.target.style.color="black"},n.onmouseleave=function(e){e.target.style.cursor="pointer",e.target.style.color="white"};o.addEventListener(document,"keydown",function(e){let i=e.code;if(key=String.fromCharCode(i),source=e.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1){let c=/Digit(\d+)/i,a=i.match(c);if(a!==null){let u=parseInt(a[1]);console.log(parseInt(a[1])),u>0&&u<=f.length&&f[u-1].action()}else i==="KeyQ"&&l.manualRemove()}},o.content)}function S(){let t="";f.forEach(function(n,e){t+=`<div id="${e}" class="menuItem">${e+1}) ${n.name}</div>`}),L.childNodes[0].innerHTML=t,P()}document.getElementById("menu")||(R(),S());})();
