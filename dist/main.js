(()=>{var f={name:"Close menu",eventListeners:null,actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&f.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),f.eventListeners.clearAllListeners()}},s=f;var l={eventListeners:null,name:"Settings",addEventListeners:function(t){let n=document.getElementById("addToStudentUrlPath");l.eventListeners.addEventListener(n,"input",function(d){window.sessionStorage.setItem("addToStudentUrlPath",d.target.value)},l.eventListeners.content);let e=document.getElementById("exitOnAction");l.eventListeners.addEventListener(e,"change",function(){window.sessionStorage.setItem("exitOnAction",e.checked)},l.eventListeners.content);let o=document.getElementById("return");l.eventListeners.addEventListener(o,"click",function(d){l.eventListeners.clearContentListeners(),t()},l.eventListeners.content);let a=document.getElementById("reset");l.eventListeners.addEventListener(a,"click",function(d){window.sessionStorage.clear(),l.eventListeners.clearContentListeners(),renderHtml(t)},l.eventListeners.content)},renderHtml:function(t){console.log("hej");let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=window.sessionStorage.getItem("exitOnAction")=="true",o=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${n||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${e?"checked":"undefined"}>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,a=document.getElementById("menuContent");a.innerHTML=o,l.addEventListeners(t)}},m=l;var h=300,y=400,i=document.createElement("div");i.id="menu";i.style.height=`${h}px`;i.style.width=`${y}px`;i.style.position="absolute";i.style.top=window.innerHeight/2-h/2+"px";i.style.left=window.innerWidth/2-y/2+"px";i.style.border="5px solid black";i.style.padding="1em";i.style.backgroundColor="rgba(113, 77, 168, 0.86)";i.style.color="white";i.style.fontSize="24px";var x=document.createElement("div");x.id="menuContent";var u=document.createElement("div");u.style.position="absolute";u.style.right=0;u.style.bottom=0;var g=document.createElement("button");g.id=s.name;g.innerText=s.name;var L=document.createElement("button");L.id=m.name;L.innerText=m.name;u.appendChild(L);u.appendChild(g);i.appendChild(x);i.appendChild(u);var v=i;var r={permanentListeners:[],permanent:"permanent",content:"content",contentListeners:[],addEventListener:function(t,n,e,o){t.addEventListener(n,e),console.log(r.contentListeners),console.log(r.permanentListeners),o===r.permanent?r.permanentListeners.push([t,n,e]):r.contentListeners.push([t,n,e])},clearAllListeners:function(){console.log(r.permanentListeners),r.permanentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),r.permanentListeners=[],r.clearContentListeners()},clearContentListeners:function(){console.log(r.contentListeners),r.contentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),r.contentListeners=[]}},c=r;var T={name:"Open student link",action:function(){let t=window.sessionStorage.getItem("addToStudentUrlPath"),n=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,a=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(n);if(a!==null){let d=`${a}me/${t||""}`;window.open(d,"_blank")}s.actionRemove()}},w=T;var _={name:"Open Umbridge link",action:function(){let t=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,n=document.querySelectorAll("div.comment_flex > span");n.length==0&&(n=document.querySelectorAll("[data-testid=submission-comment]"));for(var e=n.length-1;e>=0;e--){let o=n[e].innerHTML.match(t),a=!1;if(o!==null){window.open(o,"_blank");break}}s.actionRemove()}},E=_;var $={name:"Calculate quiz score",action:function(){let t=document.querySelectorAll(".assignment_score"),n=0,e=0;t.forEach(o=>{o.parentElement.querySelectorAll(".tooltip").forEach(d=>{let I=d.innerText.replace(/\s/g,""),C=/(-|\d[\d,]*)\/(\d[\d,]*)/,p=I.match(C);if(p){p[1]==="-"&&(p[1]=0);let B=parseFloat(p[1]),A=parseFloat(p[2]);n+=B,e+=A}})}),alert(`Po\xE4ng: ${n} / ${e}
Score: ${Math.ceil(n/(e/2)*10)/10/2}`),s.actionRemove()}},b=$;var k=[w,E,b];function P(){document.body.appendChild(v),s.eventListeners=c,m.eventListeners=c;let t=document.getElementById(s.name);c.addEventListener(t,"click",s.manualRemove,c.permanent);let n=document.getElementById(m.name);c.addEventListener(n,"click",function(){c.clearContentListeners(),m.renderHtml(S)},c.permanent)}function R(){let t=document.getElementsByClassName("menuItem");for(let n of t)c.addEventListener(n,"click",function(e){k[e.target.id].action()},c.content),n.onmouseover=function(e){e.target.style.cursor="pointer",e.target.style.color="black"},n.onmouseleave=function(e){e.target.style.cursor="pointer",e.target.style.color="white"};c.addEventListener(document,"keydown",function(e){let o=e.code;key=String.fromCharCode(o),source=e.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1&&console.log("You pressed "+key+" (keyCode: "+o+").")},c.content)}function S(){let t="";k.forEach(function(n,e){t+=`<div id="${e}" class="menuItem">${e+1}) ${n.name}</div>`}),v.childNodes[0].innerHTML=t,R()}document.getElementById("menu")||(P(),S());})();
