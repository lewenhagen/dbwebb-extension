(()=>{var c={permanentListeners:[],permanent:"permanent",content:"content",contentListeners:[],addEventListener:function(n,e,t,i){n.addEventListener(e,t),i===c.permanent?c.permanentListeners.push([n,e,t]):c.contentListeners.push([n,e,t])},clearAllListeners:function(){c.permanentListeners.forEach(n=>{n[0].removeEventListener(n[1],n[2])}),c.permanentListeners=[],c.clearContentListeners()},clearContentListeners:function(){c.contentListeners.forEach(n=>{n[0].removeEventListener(n[1],n[2])}),c.contentListeners=[]}},o=c;var b={name:"Close menu",actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&b.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),o.clearAllListeners()}},s=b;var w={name:"Settings",addEventListeners:function(n){let e=document.getElementById("addToStudentUrlPath");e.focus(),o.addEventListener(e,"input",function(r){window.sessionStorage.setItem("addToStudentUrlPath",r.target.value)},o.content);let t=document.getElementById("exitOnAction");o.addEventListener(t,"change",function(){window.sessionStorage.setItem("exitOnAction",t.checked)},o.content);let i=document.getElementById("return");o.addEventListener(i,"click",function(r){o.clearContentListeners(),n()},o.content);let l=document.getElementById("reset");o.addEventListener(l,"click",function(r){window.sessionStorage.clear(),o.clearContentListeners(),renderHtml(n)},o.content)},renderHtml:function(n){let e=window.sessionStorage.getItem("addToStudentUrlPath"),t=window.sessionStorage.getItem("exitOnAction")=="true",i=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${e||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${t?"checked":"undefined"}>
            </div>
            <div style="font-size:14px;">
            Keybinds funkar i startmenyn. F\xF6ljande finns:<br>
            1-X f\xF6r varje menyval. Trycker du 1 p\xE5 tangetbordet k\xF6rs val 1 osv.<br>
            q: st\xE4nger ner menyn.<br>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,l=document.getElementById("menuContent");l.innerHTML=i,w.addEventListeners(n)}},u=w;var y=300,E=400,a=document.createElement("div");a.id="menu";a.style.height=`${y}px`;a.style.width=`${E}px`;a.style.position="absolute";a.style.top=window.innerHeight/2-y/2+"px";a.style.left=window.innerWidth/2-E/2+"px";a.style.border="5px solid black";a.style.padding="1em";a.style.backgroundColor="rgba(113, 77, 168, 0.86)";a.style.color="white";a.style.fontSize="24px";var L=document.createElement("div");L.id="menuContent";var p=document.createElement("div");p.style.position="absolute";p.style.right=0;p.style.bottom=0;var g=document.createElement("button");g.id=s.name;g.innerText=s.name;var v=document.createElement("button");v.id=u.name;v.innerText=u.name;p.appendChild(v);p.appendChild(g);a.appendChild(L);a.appendChild(p);var x=a;var R={name:"Open student link",action:function(){let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,i=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview"),l=i.innerText.match(e);if(l!==null){let r=`${l}me/${n||""}`;window.open(r,"_blank")}else{let r=/\w{4}\d{2}/i,d=i.innerText.match(r);if(d!==null){let m=`https://www.student.bth.se/~${d}/dbwebb-kurser/`;window.open(m,"_blank")}}s.actionRemove()}},k=R;var $={name:"Open Umbridge link",action:function(){let n=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,e=document.querySelectorAll("div.comment_flex > span");e.length==0&&(e=document.querySelectorAll("[data-testid=submission-comment]"));for(var t=e.length-1;t>=0;t--){let i=e[t].innerHTML.match(n),l=!1;if(i!==null){window.open(i,"_blank");break}}s.actionRemove()}},S=$;var H={name:"Calculate quiz score",action:function(){let n=document.querySelectorAll(".assignment_score"),e=0,t=0;n.forEach(i=>{i.parentElement.querySelectorAll(".tooltip").forEach(r=>{let d=r.innerText.replace(/\s/g,""),m=/(-|\d[\d,]*)\/(\d[\d,]*)/,f=d.match(m);if(f){f[1]==="-"&&(f[1]=0);let _=parseFloat(f[1]),A=parseFloat(f[2]);e+=_,t+=A}})}),alert(`Po\xE4ng: ${e} / ${t}
Score: ${Math.ceil(e/(t/2)*10)/10/2}`),s.actionRemove()}},C=H;function P(n){let e=document.createElement("div");e.style="width:600px;height:800px;overflow:scroll;position:absolute;top:50px;left:20px;background-color:#2C3539;color:#fff;padding:10px;";let t=document.createElement("button");t.textContent="St%C3%A4ng",t.addEventListener("click",function(){e.parentNode.removeChild(e)}),e.appendChild(t),n.forEach(function(i,l){let r=document.createElement("div");r.innerHTML="<h2>kmom0"+(l+1)+"</h2>",r.innerHTML+=i.body,e.appendChild(r)}),document.body.appendChild(e)}var M={name:"Show all redovisningstexter (not working, need Canvas token)",action:function(){let n=window.location.pathname,e=window.location.search,t=n.split("/")[2],i=/student_id=(\d+)/i,l=e.match(i)[1],r="Bearer [INSERT KEY HERE]",d=`/api/v1/courses/${t}/students/submissions?student_ids[]=${l}`;fetch(d,{headers:{Authorization:r}}).then(function(m){return m.json()}).then(function(m){P(m)}),s.actionRemove()}},I=M;var O={name:"Skriv kommentar",action:function(){let n=document.getElementById("speed_grader_comment_textarea")?"speed-franklin.js":"franklin.js";document.body.appendChild(document.createElement("script")).src="https://booklets.emilfolino.se/"+n,document.getElementById("feedbackText").focus(),s.actionRemove()}},B=O;var h=[k,S,B,C,I];function U(){document.body.appendChild(x);let n=document.getElementById(s.name);o.addEventListener(n,"click",s.manualRemove,o.permanent);let e=document.getElementById(u.name);o.addEventListener(e,"click",function(){o.clearContentListeners(),u.renderHtml(T)},o.permanent)}function q(){let n=document.getElementsByClassName("menuItem");for(let e of n)o.addEventListener(e,"click",function(t){h[t.target.id].action()},o.content),e.onmouseover=function(t){t.target.style.cursor="pointer",t.target.style.color="black"},e.onmouseleave=function(t){t.target.style.cursor="pointer",t.target.style.color="white"};o.addEventListener(document,"keydown",function(t){let i=t.code;if(key=String.fromCharCode(i),source=t.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1){let l=/Digit(\d+)/i,r=i.match(l);if(r!==null){let d=parseInt(r[1]);d>0&&d<=h.length&&h[d-1].action()}else i==="KeyQ"&&s.manualRemove()}},o.content)}function T(){let n="";h.forEach(function(e,t){n+=`<div id="${t}" class="menuItem">${t+1}) ${e.name}</div>`}),x.childNodes[0].innerHTML=n,q()}document.getElementById("menu")||(U(),T());})();
