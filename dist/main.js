(()=>{var L={name:"Close menu",actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&document.getElementById("menu").remove()},manualRemove:function(){document.getElementById("menu").remove()}},l=L;function T(n){document.getElementById("addToStudentUrlPath").addEventListener("input",function(d){window.sessionStorage.setItem("addToStudentUrlPath",d.target.value)});let t=document.getElementById("exitOnAction");t.addEventListener("change",function(){window.sessionStorage.setItem("exitOnAction",t.checked)}),document.getElementById("return").addEventListener("click",function(d){n()}),document.getElementById("reset").addEventListener("click",function(d){window.sessionStorage.clear(),f(n)})}function f(n){let e=window.sessionStorage.getItem("addToStudentUrlPath"),t=window.sessionStorage.getItem("exitOnAction")=="true",r=`
    <div>
    <label>Pathto add after "me/" in link opener</label>
    <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${e||"kmom0x/assignment"}" >
    </div>
    <div>
    <label>Automatically exit plugin menu after running a script?</label>
    <input type="checkbox" class="menuItem" id="exitOnAction" ${t?"checked":"undefined"}>
    </div>
    <button id="return">Return</button>
    <button id="reset">Reset session</button>
    `,o=document.getElementById("menuContent");o.innerHTML=r,T(n)}var _={name:"Settings",renderHtml:f},m=_;var g=300,h=400,i=document.createElement("div");i.id="menu";i.style.height=`${g}px`;i.style.width=`${h}px`;i.style.position="absolute";i.style.top=window.innerHeight/2-g/2+"px";i.style.left=window.innerWidth/2-h/2+"px";i.style.border="5px solid black";i.style.padding="1em";i.style.backgroundColor="rgba(113, 77, 168, 0.86)";i.style.color="white";i.style.fontSize="24px";var y=document.createElement("div");y.id="menuContent";var a=document.createElement("div");a.style.position="absolute";a.style.right=0;a.style.bottom=0;var c=document.createElement("button");c.id=l.name;c.innerText=l.name;var u=document.createElement("button");u.id=m.name;u.innerText=m.name;a.appendChild(u);a.appendChild(c);i.appendChild(y);i.appendChild(a);var p=i;var A={name:"Open student link",action:function(){let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\/me\//i,o=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(e);if(o!==null){let d=o+(n||"");window.open(d,"_blank")}l.actionRemove()}},w=A;var C={name:"Open Umbridge link",action:function(){let n=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,e=document.querySelectorAll("div.comment_flex > span");e.length==0&&(e=document.querySelectorAll("[data-testid=submission-comment]"));for(var t=e.length-1;t>=0;t--){let r=e[t].innerHTML.match(n),o=!1;if(r!==null){window.open(r,"_blank");break}}l.actionRemove()}},x=C;var P={name:"Calculate quiz score",action:function(){let n=document.querySelectorAll(".assignment_score"),e=0,t=0;n.forEach(r=>{r.parentElement.querySelectorAll(".tooltip").forEach(d=>{let S=d.innerText.replace(/\s/g,""),B=/(-|\d[\d,]*)\/(\d[\d,]*)/,s=S.match(B);if(s){s[1]==="-"&&(s[1]=0);let I=parseFloat(s[1]),k=parseFloat(s[2]);e+=I,t+=k}})}),alert(`Po\xE4ng: ${e} / ${t}
Score: ${Math.ceil(e/(t/2)*10)/10/2}`),l.actionRemove()}},b=P;var v=[w,x,b];document.getElementById("menu")?l.manualRemove():E();function R(){let n=document.getElementsByClassName("menuItem");for(let r of n)r.addEventListener("click",function(o){v[o.target.id].action()}),r.onmouseover=function(o){o.target.style.cursor="pointer",o.target.style.color="black"},r.onmouseleave=function(o){o.target.style.cursor="pointer",o.target.style.color="white"};document.getElementById(l.name).addEventListener("click",l.manualRemove),document.getElementById(m.name).addEventListener("click",function(){m.renderHtml(E)})}function E(){let n="";v.forEach(function(e,t){n+=`<div id="${t}" class="menuItem">${t+1}) ${e.name}</div>`}),p.childNodes[0].innerHTML=n,document.body.appendChild(p),R()}})();
