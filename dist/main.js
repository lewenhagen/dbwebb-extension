(()=>{var d={permanentListeners:[],permanent:"permanent",content:"content",contentListeners:[],addEventListener:function(n,e,t,i){n.addEventListener(e,t),i===d.permanent?d.permanentListeners.push([n,e,t]):d.contentListeners.push([n,e,t])},clearAllListeners:function(){d.permanentListeners.forEach(n=>{n[0].removeEventListener(n[1],n[2])}),d.permanentListeners=[],d.clearContentListeners()},clearContentListeners:function(){d.contentListeners.forEach(n=>{n[0].removeEventListener(n[1],n[2])}),d.contentListeners=[]}},o=d;var y={name:"Close menu",actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&y.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),o.clearAllListeners()}},r=y;var E={name:"Settings",addEventListeners:function(n){let e=document.getElementById("addToStudentUrlPath");e.focus(),o.addEventListener(e,"input",function(s){window.sessionStorage.setItem("addToStudentUrlPath",s.target.value)},o.content);let t=document.getElementById("exitOnAction");o.addEventListener(t,"change",function(){window.sessionStorage.setItem("exitOnAction",t.checked)},o.content);let i=document.getElementById("return");o.addEventListener(i,"click",function(s){o.clearContentListeners(),n()},o.content);let a=document.getElementById("reset");o.addEventListener(a,"click",function(s){window.sessionStorage.clear(),o.clearContentListeners(),renderHtml(n)},o.content)},renderHtml:function(n){let e=window.sessionStorage.getItem("addToStudentUrlPath"),t=window.sessionStorage.getItem("exitOnAction")=="true",i=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${e||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${t?"checked":"undefined"}>
            </div>
            <div style="font-size:14px;">
            Keybinds funkar i startmenyn. F\xF6ljande finns:<br>
            1-X f\xF6r varje menyval. Trycker du 1 p\xE5 tangetbordet k\xF6rs val 1 osv.<br>
            q: st\xE4nger ner menyn.<br>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,a=document.getElementById("menuContent");a.innerHTML=i,E.addEventListeners(n)}},m=E;var b=300,w=400,l=document.createElement("div");l.id="menu";l.style.height=`${b}px`;l.style.width=`${w}px`;l.style.position="absolute";l.style.top=window.innerHeight/2-b/2+"px";l.style.left=window.innerWidth/2-w/2+"px";l.style.border="5px solid black";l.style.padding="1em";l.style.backgroundColor="rgba(113, 77, 168, 0.86)";l.style.color="white";l.style.fontSize="24px";var L=document.createElement("div");L.id="menuContent";var u=document.createElement("div");u.style.position="absolute";u.style.right=0;u.style.bottom=0;var g=document.createElement("button");g.id=r.name;g.innerText=r.name;var v=document.createElement("button");v.id=m.name;v.innerText=m.name;u.appendChild(v);u.appendChild(g);l.appendChild(L);l.appendChild(u);var x=l;var R={name:"Open student link",action:function(){let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,a=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(e);if(a!==null){let s=`${a}me/${n||""}`;window.open(s,"_blank")}r.actionRemove()}},k=R;var $={name:"Open Umbridge link",action:function(){let n=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,e=document.querySelectorAll("div.comment_flex > span");e.length==0&&(e=document.querySelectorAll("[data-testid=submission-comment]"));for(var t=e.length-1;t>=0;t--){let i=e[t].innerHTML.match(n),a=!1;if(i!==null){window.open(i,"_blank");break}}r.actionRemove()}},S=$;var H={name:"Calculate quiz score",action:function(){let n=document.querySelectorAll(".assignment_score"),e=0,t=0;n.forEach(i=>{i.parentElement.querySelectorAll(".tooltip").forEach(s=>{let c=s.innerText.replace(/\s/g,""),p=/(-|\d[\d,]*)\/(\d[\d,]*)/,f=c.match(p);if(f){f[1]==="-"&&(f[1]=0);let _=parseFloat(f[1]),A=parseFloat(f[2]);e+=_,t+=A}})}),alert(`Po\xE4ng: ${e} / ${t}
Score: ${Math.ceil(e/(t/2)*10)/10/2}`),r.actionRemove()}},C=H;function P(n){let e=document.createElement("div");e.style="width:600px;height:800px;overflow:scroll;position:absolute;top:50px;left:20px;background-color:#2C3539;color:#fff;padding:10px;";let t=document.createElement("button");t.textContent="St%C3%A4ng",t.addEventListener("click",function(){e.parentNode.removeChild(e)}),e.appendChild(t),n.forEach(function(i,a){let s=document.createElement("div");s.innerHTML="<h2>kmom0"+(a+1)+"</h2>",s.innerHTML+=i.body,e.appendChild(s)}),document.body.appendChild(e)}var M={name:"Show all redovisningstexter (not working, need Canvas token)",action:function(){let n=window.location.pathname,e=window.location.search,t=n.split("/")[2],i=/student_id=(\d+)/i,a=e.match(i)[1],s="Bearer [INSERT KEY HERE]",c=`/api/v1/courses/${t}/students/submissions?student_ids[]=${a}`;fetch(c,{headers:{Authorization:s}}).then(function(p){return p.json()}).then(function(p){P(p)}),r.actionRemove()}},I=M;var O={name:"Skriv kommentar",action:function(){let n=document.getElementById("speed_grader_comment_textarea")?"speed-franklin.js":"franklin.js";document.body.appendChild(document.createElement("script")).src="https://booklets.emilfolino.se/"+n,r.actionRemove()}},B=O;var h=[k,S,B,C,I];function U(){document.body.appendChild(x);let n=document.getElementById(r.name);o.addEventListener(n,"click",r.manualRemove,o.permanent);let e=document.getElementById(m.name);o.addEventListener(e,"click",function(){o.clearContentListeners(),m.renderHtml(T)},o.permanent)}function q(){let n=document.getElementsByClassName("menuItem");for(let e of n)o.addEventListener(e,"click",function(t){h[t.target.id].action()},o.content),e.onmouseover=function(t){t.target.style.cursor="pointer",t.target.style.color="black"},e.onmouseleave=function(t){t.target.style.cursor="pointer",t.target.style.color="white"};o.addEventListener(document,"keydown",function(t){let i=t.code;if(key=String.fromCharCode(i),source=t.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1){let a=/Digit(\d+)/i,s=i.match(a);if(s!==null){let c=parseInt(s[1]);c>0&&c<=h.length&&h[c-1].action()}else i==="KeyQ"&&r.manualRemove()}},o.content)}function T(){let n="";h.forEach(function(e,t){n+=`<div id="${t}" class="menuItem">${t+1}) ${e.name}</div>`}),x.childNodes[0].innerHTML=n,q()}document.getElementById("menu")||(U(),T());})();
