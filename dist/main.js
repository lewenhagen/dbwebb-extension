(()=>{var f={name:"Close menu",eventListeners:null,actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&f.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),f.eventListeners.clearEventListeners()}},i=f;var c={eventListeners:null,name:"Settings",addEventListeners:function(n){let t=document.getElementById("addToStudentUrlPath");c.eventListeners.addEventListener(t,"input",function(d){window.sessionStorage.setItem("addToStudentUrlPath",d.target.value)});let e=document.getElementById("exitOnAction");c.eventListeners.addEventListener(e,"change",function(){window.sessionStorage.setItem("exitOnAction",e.checked)});let r=document.getElementById("return");c.eventListeners.addEventListener(r,"click",function(d){n()});let s=document.getElementById("reset");c.eventListeners.addEventListener(s,"click",function(d){window.sessionStorage.clear(),renderHtml(n)})},renderHtml:function(n){console.log("hej");let t=window.sessionStorage.getItem("addToStudentUrlPath"),e=window.sessionStorage.getItem("exitOnAction")=="true",r=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${t||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${e?"checked":"undefined"}>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,s=document.getElementById("menuContent");s.innerHTML=r,c.addEventListeners(n)}},l=c;var y=300,L=400,o=document.createElement("div");o.id="menu";o.style.height=`${y}px`;o.style.width=`${L}px`;o.style.position="absolute";o.style.top=window.innerHeight/2-y/2+"px";o.style.left=window.innerWidth/2-L/2+"px";o.style.border="5px solid black";o.style.padding="1em";o.style.backgroundColor="rgba(113, 77, 168, 0.86)";o.style.color="white";o.style.fontSize="24px";var x=document.createElement("div");x.id="menuContent";var m=document.createElement("div");m.style.position="absolute";m.style.right=0;m.style.bottom=0;var g=document.createElement("button");g.id=i.name;g.innerText=i.name;var v=document.createElement("button");v.id=l.name;v.innerText=l.name;m.appendChild(v);m.appendChild(g);o.appendChild(x);o.appendChild(m);var h=o;var u={addedListeners:[],addEventListener:function(n,t,e){n.addEventListener(t,e),u.addedListeners.push([n,t,e]),console.log(u.addedListeners)},clearEventListeners:function(){console.log(u.addedListeners),u.addedListeners.forEach(n=>{n[0].removeEventListener(n[1],n[2])}),u.addedListeners=[]}},a=u;var _={name:"Open student link",action:function(){let n=window.sessionStorage.getItem("addToStudentUrlPath"),t=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,s=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(t);if(s!==null){let d=`${s}me/${n||""}`;window.open(d,"_blank")}i.actionRemove()}},w=_;var $={name:"Open Umbridge link",action:function(){let n=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,t=document.querySelectorAll("div.comment_flex > span");t.length==0&&(t=document.querySelectorAll("[data-testid=submission-comment]"));for(var e=t.length-1;e>=0;e--){let r=t[e].innerHTML.match(n),s=!1;if(r!==null){window.open(r,"_blank");break}}i.actionRemove()}},E=$;var A={name:"Calculate quiz score",action:function(){let n=document.querySelectorAll(".assignment_score"),t=0,e=0;n.forEach(r=>{r.parentElement.querySelectorAll(".tooltip").forEach(d=>{let I=d.innerText.replace(/\s/g,""),B=/(-|\d[\d,]*)\/(\d[\d,]*)/,p=I.match(B);if(p){p[1]==="-"&&(p[1]=0);let C=parseFloat(p[1]),T=parseFloat(p[2]);t+=C,e+=T}})}),alert(`Po\xE4ng: ${t} / ${e}
Score: ${Math.ceil(t/(e/2)*10)/10/2}`),i.actionRemove()}},b=A;var k=[w,E,b];function P(){document.body.appendChild(h),i.eventListeners=a,l.eventListeners=a;let n=document.getElementById(i.name);a.addEventListener(n,"click",i.manualRemove);let t=document.getElementById(l.name);a.addEventListener(t,"click",function(){l.renderHtml(S)}),a.addEventListener(document,"keydown",function(r){let s=r.code;key=String.fromCharCode(s),source=r.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1&&console.log("You pressed "+key+" (keyCode: "+s+").")})}function R(){let n=document.getElementsByClassName("menuItem");for(let t of n)a.addEventListener(t,"click",function(e){k[e.target.id].action()}),t.onmouseover=function(e){e.target.style.cursor="pointer",e.target.style.color="black"},t.onmouseleave=function(e){e.target.style.cursor="pointer",e.target.style.color="white"}}function S(){let n="";k.forEach(function(t,e){n+=`<div id="${e}" class="menuItem">${e+1}) ${t.name}</div>`}),h.childNodes[0].innerHTML=n,R()}document.getElementById("menu")||(P(),S());})();
