(()=>{var i={permanentListeners:[],permanent:"permanent",content:"content",contentListeners:[],addEventListener:function(t,n,e,o){t.addEventListener(n,e),console.log(i.contentListeners),console.log(i.permanentListeners),o===i.permanent?i.permanentListeners.push([t,n,e]):i.contentListeners.push([t,n,e])},clearAllListeners:function(){console.log(i.permanentListeners),i.permanentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),i.permanentListeners=[],i.clearContentListeners()},clearContentListeners:function(){console.log(i.contentListeners),i.contentListeners.forEach(t=>{t[0].removeEventListener(t[1],t[2])}),i.contentListeners=[],console.log(i.contentListeners)}},s=i;var x={name:"Close menu",eventListeners:null,actionRemove:function(){window.sessionStorage.getItem("exitOnAction")==="true"&&x.manualRemove()},manualRemove:function(){document.getElementById("menu").remove(),s.clearAllListeners()}},r=x;var a={eventListeners:null,name:"Settings",addEventListeners:function(t){let n=document.getElementById("addToStudentUrlPath");a.eventListeners.addEventListener(n,"input",function(c){window.sessionStorage.setItem("addToStudentUrlPath",c.target.value)},a.eventListeners.content);let e=document.getElementById("exitOnAction");a.eventListeners.addEventListener(e,"change",function(){window.sessionStorage.setItem("exitOnAction",e.checked)},a.eventListeners.content);let o=document.getElementById("return");a.eventListeners.addEventListener(o,"click",function(c){a.eventListeners.clearContentListeners(),t()},a.eventListeners.content);let d=document.getElementById("reset");a.eventListeners.addEventListener(d,"click",function(c){window.sessionStorage.clear(),a.eventListeners.clearContentListeners(),renderHtml(t)},a.eventListeners.content)},renderHtml:function(t){console.log("hej");let n=window.sessionStorage.getItem("addToStudentUrlPath"),e=window.sessionStorage.getItem("exitOnAction")=="true",o=`
            <div>
            <label>Pathto add after "me/" in link opener</label>
            <input type="text" class="menuItem" id="addToStudentUrlPath" placeholder="${n||"kmom0x/assignment"}" >
            </div>
            <div>
            <label>Automatically exit plugin menu after running a script?</label>
            <input type="checkbox" class="menuItem" id="exitOnAction" ${e?"checked":"undefined"}>
            </div>
            <button id="return">Return</button>
            <button id="reset">Reset session</button>
            `,d=document.getElementById("menuContent");d.innerHTML=o,a.addEventListeners(t)}},m=a;var y=300,w=400,l=document.createElement("div");l.id="menu";l.style.height=`${y}px`;l.style.width=`${w}px`;l.style.position="absolute";l.style.top=window.innerHeight/2-y/2+"px";l.style.left=window.innerWidth/2-w/2+"px";l.style.border="5px solid black";l.style.padding="1em";l.style.backgroundColor="rgba(113, 77, 168, 0.86)";l.style.color="white";l.style.fontSize="24px";var E=document.createElement("div");E.id="menuContent";var u=document.createElement("div");u.style.position="absolute";u.style.right=0;u.style.bottom=0;var L=document.createElement("button");L.id=r.name;L.innerText=r.name;var v=document.createElement("button");v.id=m.name;v.innerText=m.name;u.appendChild(v);u.appendChild(L);l.appendChild(E);l.appendChild(u);var h=l;var T={name:"Open student link",action:function(){let t=window.sessionStorage.getItem("addToStudentUrlPath"),n=/https?:\/\/w+.student.bth.se\/~\w{4}\d{2}\/dbwebb-kurser\/\w+\//i,d=document.getElementById("speedgrader_iframe").contentWindow.document.getElementById("submission_preview").innerText.match(n);if(d!==null){let c=`${d}me/${t||""}`;window.open(c,"_blank")}r.actionRemove()}},b=T;var _={name:"Open Umbridge link",action:function(){let t=/https:\/\/umbridge\.arnesson\.dev\/results\/inspect\/\d+\/[\w]+/i,n=document.querySelectorAll("div.comment_flex > span");n.length==0&&(n=document.querySelectorAll("[data-testid=submission-comment]"));for(var e=n.length-1;e>=0;e--){let o=n[e].innerHTML.match(t),d=!1;if(o!==null){window.open(o,"_blank");break}}r.actionRemove()}},k=_;var $={name:"Calculate quiz score",action:function(){let t=document.querySelectorAll(".assignment_score"),n=0,e=0;t.forEach(o=>{o.parentElement.querySelectorAll(".tooltip").forEach(c=>{let p=c.innerText.replace(/\s/g,""),C=/(-|\d[\d,]*)\/(\d[\d,]*)/,f=p.match(C);if(f){f[1]==="-"&&(f[1]=0);let B=parseFloat(f[1]),A=parseFloat(f[2]);n+=B,e+=A}})}),alert(`Po\xE4ng: ${n} / ${e}
Score: ${Math.ceil(n/(e/2)*10)/10/2}`),r.actionRemove()}},I=$;var g=[b,k,I];function R(){document.body.appendChild(h),r.eventListeners=s,m.eventListeners=s;let t=document.getElementById(r.name);s.addEventListener(t,"click",r.manualRemove,s.permanent);let n=document.getElementById(m.name);s.addEventListener(n,"click",function(){s.clearContentListeners(),m.renderHtml(S)},s.permanent)}function P(){let t=document.getElementsByClassName("menuItem");for(let n of t)s.addEventListener(n,"click",function(e){g[e.target.id].action()},s.content),n.onmouseover=function(e){e.target.style.cursor="pointer",e.target.style.color="black"},n.onmouseleave=function(e){e.target.style.cursor="pointer",e.target.style.color="white"};s.addEventListener(document,"keydown",function(e){let o=e.code;if(key=String.fromCharCode(o),source=e.target,exclude=["input","textarea"],exclude.indexOf(source.tagName.toLowerCase())===-1){let d=/Digit(\d+)/i,c=o.match(d);if(c!==null){let p=parseInt(c[1]);console.log(parseInt(c[1])),p>0&&p<=g.length&&g[p-1].action()}else o==="KeyQ"&&r.manualRemove()}},s.content)}function S(){let t="";g.forEach(function(n,e){t+=`<div id="${e}" class="menuItem">${e+1}) ${n.name}</div>`}),h.childNodes[0].innerHTML=t,P()}document.getElementById("menu")||(R(),S());})();
